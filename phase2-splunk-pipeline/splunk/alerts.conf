# Splunk Alert Actions Configuration – Phase 2 Security Pipeline
# ===============================================================
# Deploy by copying to:
#   $SPLUNK_HOME/etc/apps/<your_app>/local/alerts.conf
#
# These stanzas configure action triggers for the saved searches defined in
# savedsearches.conf.  They are NOT standalone – they require the
# corresponding [<search name>] stanzas in savedsearches.conf.

[default]
# Global throttle: never fire the same alert more than once every 5 minutes
# for the same combination of field values.  This prevents alert fatigue from
# noisy, high-frequency detections while still ensuring prompt notification.
alert.suppress         = 1
alert.suppress.period  = 5m
alert.suppress.fields  = src_ip, dst_ip


# ──────────────────────────────────────────────────────────────────────────────
# Brute Force SSH alert
# ──────────────────────────────────────────────────────────────────────────────
[Brute Force SSH - 5+ Failures in 60s]
# E-mail: notify SOC and on-call engineer for high/critical SSH brute-force.
action.email                   = 1
action.email.to                = soc-team@example.com, oncall@example.com
action.email.subject           = [ALERT] SSH Brute Force Detected – $result.src_ip$
action.email.message.alert     = SSH brute force: $result.count$ failures in 60 s from $result.src_ip$ → $result.dst_ip$ (severity=$result.severity$)
action.email.include.results_link = 1
action.email.sendresults       = 1

# Webhook: forward to SOAR (Phase 3) for automated containment playbook.
action.webhook                 = 1
action.webhook.param.url       = http://soar-platform:8000/webhooks/splunk-alert
action.webhook.param.ttl       = 300

# Throttle per source IP to avoid flooding SOAR with the same active attack.
alert.suppress.fields  = src_ip
alert.suppress.period  = 5m


# ──────────────────────────────────────────────────────────────────────────────
# C2 Beaconing alert
# ──────────────────────────────────────────────────────────────────────────────
[C2 Beaconing - Regular Interval Outbound Connections]
action.email               = 1
action.email.to            = soc-team@example.com
action.email.subject       = [ALERT][CRITICAL] Possible C2 Beacon – $result.src_ip$ → $result.dst_ip$:$result.dst_port$
action.email.message.alert = Beaconing detected: CV=$result.cv$, connections=$result.count$, mean_interval=$result.mean_interval$s
action.email.include.results_link = 1

action.webhook             = 1
action.webhook.param.url   = http://soar-platform:8000/webhooks/splunk-alert

# Suppress per src→dst pair; each unique pair is a separate potential implant.
alert.suppress.fields  = src_ip, dst_ip
alert.suppress.period  = 15m


# ──────────────────────────────────────────────────────────────────────────────
# Phase 1 Normalizer – Malicious IOC
# ──────────────────────────────────────────────────────────────────────────────
[Phase 1 Normalizer - Malicious IOC Detected]
action.email               = 1
action.email.to            = soc-team@example.com, threat-intel@example.com
action.email.subject       = [ALERT] Threat Intel IOC – $result.indicator$ ($result.indicator_type$)
action.email.message.alert = Malicious IOC: $result.indicator$ | Score: $result.max_score$ | Family: $result.indicator_family$
action.email.sendresults   = 1

action.webhook             = 1
action.webhook.param.url   = http://soar-platform:8000/webhooks/splunk-alert

alert.suppress.fields  = indicator
alert.suppress.period  = 1h


# ──────────────────────────────────────────────────────────────────────────────
# Rare Process Execution
# ──────────────────────────────────────────────────────────────────────────────
[Rare Process Execution - Statistical Outlier]
action.email               = 1
action.email.to            = soc-team@example.com
action.email.subject       = [ALERT] Rare Process Execution – $result.process_name$
action.email.message.alert = Rare process: $result.process_name$ seen on $result.host_count$ host(s)

action.webhook             = 1
action.webhook.param.url   = http://soar-platform:8000/webhooks/splunk-alert

alert.suppress.fields  = process_name
alert.suppress.period  = 30m


# ──────────────────────────────────────────────────────────────────────────────
# Critical File-Hash IOC on Endpoint
# ──────────────────────────────────────────────────────────────────────────────
[Endpoint IOC - Critical File Hash Match]
action.email               = 1
action.email.to            = soc-team@example.com, ir-team@example.com
action.email.subject       = [CRITICAL] Malware Detected – $result.hostname$
action.email.message.alert = Critical hash match on $result.hostname$: $result.threats$ | SHA256: $result.sha256$
action.email.sendresults   = 1

action.webhook             = 1
action.webhook.param.url   = http://soar-platform:8000/webhooks/splunk-alert

# Each unique host+hash pair may be a separate infection.
alert.suppress.fields  = hostname, sha256
alert.suppress.period  = 30m


# ──────────────────────────────────────────────────────────────────────────────
# Suspicious DNS
# ──────────────────────────────────────────────────────────────────────────────
[Suspicious DNS - DGA or Tunnel Query]
action.email               = 1
action.email.to            = soc-team@example.com
action.email.subject       = [ALERT] Suspicious DNS Query – $result.src_ip$
action.email.message.alert = Suspicious DNS: $result.query$ ($result.label$) from $result.src_ip$

action.webhook             = 1
action.webhook.param.url   = http://soar-platform:8000/webhooks/splunk-alert

alert.suppress.fields  = src_ip, query
alert.suppress.period  = 10m
